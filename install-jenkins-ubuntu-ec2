#!/bin/bash

# ================================
# Jenkins Installation Script
# Created by: Tech Mahato | Arbind Sir
# YouTube Channel: Tech Mahato (https://www.youtube.com/c/TechMahato?sub_confirmation=1)
# ================================

echo "========================================"
echo "ğŸ’» Jenkins Installation Script by Tech Mahato"
echo "ğŸ“¢ Subscribe to our YouTube channel: https://www.youtube.com/c/TechMahato?sub_confirmation=1"
echo "========================================"

# Step 1: Update system packages
echo "ğŸ”„ Updating system packages..."
sudo apt update -y

# Step 2: Install Java Development Kit (JDK) 17
echo "â˜• Installing OpenJDK 17..."
sudo apt install -y openjdk-17-jdk

# Step 3: Add Jenkins repository key
echo "ğŸ”‘ Adding Jenkins repository key..."
wget -q -O - https://pkg.jenkins.io/debian-stable/jenkins.io-2023.key | sudo tee /usr/share/keyrings/jenkins-keyring.asc > /dev/null

# Step 4: Add Jenkins repository
echo "ğŸ“¦ Adding Jenkins repository..."
echo "deb [signed-by=/usr/share/keyrings/jenkins-keyring.asc] https://pkg.jenkins.io/debian-stable binary/" | sudo tee /etc/apt/sources.list.d/jenkins.list > /dev/null

# Step 5: Update package lists
echo "ğŸ”„ Updating package lists..."
sudo apt update -y

# Step 6: Install Jenkins
echo "ğŸš€ Installing Jenkins..."
sudo apt install -y jenkins

# Step 7: Enable and start Jenkins service
echo "âš™ï¸ Enabling and starting Jenkins service..."
sudo systemctl enable --now jenkins

# Step 8: Check Jenkins service status
echo "ğŸ” Checking Jenkins status..."
sudo systemctl status jenkins --no-pager

# Step 9: Show Jenkins version
echo "ğŸ“Œ Fetching Jenkins version..."
jenkins_version=$(jenkins --version 2>/dev/null)
if [ -z "$jenkins_version" ]; then
    echo "âŒ Jenkins version could not be retrieved! Make sure Jenkins is installed correctly."
else
    echo "âœ… Jenkins Version: $jenkins_version"
fi

# Step 10: Retrieve and display Jenkins initial admin password
echo "ğŸ”‘ Fetching Jenkins initial admin password..."
if [ -f "/var/lib/jenkins/secrets/initialAdminPassword" ]; then
    jenkins_password=$(sudo cat /var/lib/jenkins/secrets/initialAdminPassword)
    echo "ğŸ› ï¸ Jenkins Admin Password: $jenkins_password"
else
    echo "âš ï¸ Jenkins initial admin password file not found!"
fi

# Step 11: Print access instructions
echo "========================================"
echo "ğŸ‰ Jenkins installation is complete!"
echo "ğŸŒ Access Jenkins at: http://your_server_ip_or_domain:8080"
echo "ğŸ› ï¸ Follow the setup wizard to complete the installation."
echo "ğŸ”“ Ensure port 8080 is open in your firewall/security group settings."
echo "ğŸ“¢ Subscribe to Tech Mahato: https://www.youtube.com/c/TechMahato?sub_confirmation=1"
echo "========================================"

# End of script
